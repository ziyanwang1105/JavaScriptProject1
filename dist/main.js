!function(){var t={87:function(t,e,i){i(393),t.exports=class{constructor(t){this.tiles=t,this.hands=[],this.maxHand=14,this.melds={chow:[],pong:[],kong:[],closed_kong:[]},this.hu,this.meldTypes={chow:!1,pong:!1,kong:!1,closed_kong:!1},this.tileCount={},this.tiles.forEach((t=>{this.tileCount[t.toString()]=0})),this.suitCount={},this.tiles.forEach((t=>{this.suitCount[t.suit]=0}))}addTile(t){let e=this.checkMeld(),i=[];if("hand"===e){this.hands.push(t),i.push(t),this.maxHand-=1;let e=t.toString();this.tileCount[e]+=1,this.suitCount[t.suit]+=1,this.handSort(),0===this.maxHand&&(this.hu=t)}else i=t.meld(e),this.melds[e].push(i),this.maxHand-=3,i.forEach((t=>{let e=t.toString();this.tileCount[e]+=1,this.suitCount[t.suit]+=1}));return i}meldSwitch(t){for(let e in this.meldTypes){let i=this.meldTypes[e];this.meldTypes[e]=e===t&&!i}}checkMeld(){let t;if(Object.values(this.meldTypes).every((t=>!t)))t="hand";else for(let e in this.meldTypes)this.meldTypes[e]&&(t=e);return t}validAdds(){let t=this.checkMeld(),e=[];if("hand"===t){if(0===this.maxHand)return e;this.tiles.forEach((t=>{this.tileCount[t.toString()]+1<=4&&e.push(t.toString())}))}else{if(this.maxHand<3)return e;this.tiles.forEach((i=>{let s=i.meld(t),n={};s.forEach((t=>{let e=t.toString();n[e]?n[e]+=1:n[e]=1}));for(let t in n){let e=n[t];this.tileCount[t]+e<=4?n[t]=!0:n[t]=!1}Object.values(n).every((t=>t))&&e.push(i.toString())}))}return e}tileCompare(t,e){let i,s;return this.tiles.forEach(((n,l)=>{t.toString()===n.toString()&&(i=l),e.toString()===n.toString()&&(s=l)})),i>s?1:-1}handSort(){this.hands.sort(((t,e)=>this.tileCompare(t,e)))}handToString(){return this.hands.map((t=>t.toString())).join(" ")}sevenPairs(){return Object.values(this.tileCount).every((t=>2===t||0===t))&&Object.values(this.melds).every((t=>0===t.length))}pureSuit(){for(let t in this.suitCount)if(14===this.suitCount[t])return t;return!1}nineGate(){let t,e={};for(let t=1;t<10;t++)e[t]=1===t||9===t?3:1;let i=this.pureSuit();return i&&this.hands.forEach((i=>{let s=i.number;e[s]?e[s]-=1:t=i})),Object.values(e).every((t=>0===t))&&i===t.suit}thirteenOrphans(){let t,e=[],i=[];Object.keys(this.suitCount).forEach((t=>{t.length>1?i.push(t):e.push(t)}));let s={};return e.forEach((t=>{s[`${t}1`]=1,s[`${t}9`]=1})),i.forEach((t=>{s[`${t}0`]=1})),this.hands.forEach((e=>{let i=e.toString();s[i]?s[i]-=1:t=e})),Object.values(s).every((t=>0===t))&&[0,1,9].includes(t.number)}checkTriplet(t){if(t.every((e=>e.equal(t[0]))))return"pong";let e=t[0];return!(!e.connectOne(t[1])||!e.connectTwo(t[2]))&&"chow"}arrayIndex(t){let e={};return t.forEach(((t,i)=>{e[t.toString()]?e[t.toString()].push(i):e[t.toString()]=[i]})),e}checkRemaining(t){let e=[...t],i=[],s=t.length/3,n=this.arrayIndex(e);for(;!Object.values(n).every((t=>3===t.length))&&0!==s;){let l=[Object.values(n).reduceRight(((t,e)=>t.length<e.length?t:e))[0]],r=t[l[0]],h=Object.values(n).flat();if(l.push(h.find((e=>r.connectOne(t[e])))),l.push(h.find((e=>r.connectTwo(t[e])))),l.every((t=>void 0!==t))){if(i.push(l),s-=1,l.forEach((t=>{n[e[t].toString()].shift()})),0===s)return i}else n[e[l[0]].toString()].shift();Object.keys(n).forEach((t=>{0===n[t].length&&delete n[t]}))}return i}trueEye(){let t=this.arrayIndex(this.hands),e={};for(let i in t){let s=t[i];s.length>1&&(e[i]=s[0])}}validHu(){let t=[],e=this.arrayIndex(this.hands),i={};for(let t in e){let s=e[t];s.length>1&&(i[t]=s[0])}for(let e in i){let s=i[e],n=[...this.hands];t.push(n.splice(s,2));let l=this.checkRemaining(n);l.forEach((e=>{t.push(e.map((t=>n[t])))})),l.flat().sort().forEach(((t,e)=>{let i=t-e;n.splice(i,1)}));let r=[];for(let e=0;e<n.length/3;e++){let i=n.slice(3*e,3*(e+1));"pong"===this.checkTriplet(i)&&(t.push([...i]),r.push(3*e))}for(let t=0;t<r.length;t++){let e=r[t];n.splice(e,3),r=r.map((t=>t>e?t-3:t))}if(0===n.length)return t;t=[]}return t}checkScore(){let t=[];return this.hu&&0===this.maxHand?([this.sevenPairs,this.thirteenOrphans,this.nineGate].forEach((e=>{e.call(this)&&t.push(e.name)})),t.length>0&&!t.includes(this.sevenPairs.name)?t:([this.pureSuit].forEach((e=>{e.call(this)&&t.push(e.name)})),t.includes(this.sevenPairs.name)?t:this.validHu().length>0?(t.push("hu"),t):["Invalid winning hand"])):["The hand is incomplete"]}}},393:function(t){class e{constructor(t,e){this.suit=t,this.number=e}toString(){return`${this.suit}${this.number}`}equal(t){return this.toString()===t.toString()}connect(t){const e=Math.abs(this.number-t.number);return this.suit===t.suit&&e<=2&&e>0}connectOne(t){const e=Math.abs(this.number-t.number);return this.suit===t.suit&&1===e}connectTwo(t){const e=Math.abs(this.number-t.number);return this.suit===t.suit&&2===e}meld(t){let i=[];switch(t){case"chow":if(this.number<7){let t=new e(this.suit,this.number+1),s=new e(this.suit,this.number+2);i.push(this,t,s)}else for(let t=7;t<10;t++){let s=new e(this.suit,t);i.push(s)}break;case"pong":for(let t=0;t<3;t++){let t=new e(this.suit,this.number);i.push(t)}break;case"kong":for(let t=0;t<4;t++){let t=new e(this.suit,this.number);i.push(t)}break;case"closed kong":for(let t=0;t<4;t++){let t=new e(this.suit,this.number);i.push(t)}}return i}}t.exports=e}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var l=e[s]={exports:{}};return t[s](l,l.exports,i),l.exports}!function(){"use strict";var t=class{constructor(t,e){this.game=t,this.tile=e,this.clickTile=this.clickTile.bind(this),this.setupTileSelector(),this.setupClickers(),this.setupMeldClickers(),this.setupCalculateClickers()}setupTileSelector(){let t=document.querySelector("#tile_selector"),e=document.createElement("ul");e.setAttribute("class","tiles"),this.tile.map(((t,i)=>{let s=document.createElement("li");s.setAttribute("class",`${t.toString()}`);let n=document.createElement("img");n.setAttribute("src",`../assets/img/64/fulltiles/${i}.png`),n.setAttribute("tile_index",i),s.appendChild(n),e.appendChild(s)})),t.append(e)}setupClickers(){let t=this.game.validAdds();document.querySelectorAll(".tiles > li").forEach((e=>{e.removeEventListener("click",this.clickTile),t.includes(e.className)&&e.addEventListener("click",this.clickTile)}))}setupMeldClickers(){document.querySelectorAll("#meld_type > button").forEach((t=>{t.addEventListener("click",this.clickMeld.bind(this))}))}setupCalculateClickers(){document.querySelector("#calculate_score").addEventListener("click",this.clickCalculate.bind(this))}clickTile(t){t.preventDefault();let e=t.target.getAttribute("tile_index"),i=this.game.tiles[e],s=this.game.checkMeld(),n=this.game.addTile(i);if("hand"===s){let t=document.querySelector(".hands");n.forEach((e=>{let i=document.createElement("li");i.setAttribute("class",`${e.toString()}`);let s=this.tile.indexOf(e),n=document.createElement("img");n.setAttribute("src",`../assets/img/64/fulltiles/${s}.png`),i.setAttribute("tile_index",s),i.appendChild(n),t.append(i)})),[...t.children].sort(((t,e)=>Number(t.getAttribute("tile_index"))>Number(e.getAttribute("tile_index"))?1:-1)).forEach((e=>{t.appendChild(e)}))}else{let t=document.querySelector(".melds"),e=document.createElement("li"),i=document.createElement("ul");i.setAttribute("meldType",`${s}`),n.forEach((s=>{let n,l=document.createElement("li");l.setAttribute("class",`${s.toString()}`),this.tile.forEach(((t,e)=>{t.equal(s)&&(n=e)}));let r=document.createElement("img");r.setAttribute("src",`../assets/img/64/fulltiles/${n}.png`),l.setAttribute("tile_index",n),l.appendChild(r),i.appendChild(l),e.appendChild(i),t.append(e)}))}this.setupClickers()}clickMeld(t){t.preventDefault();let e=t.target.getAttribute("id");this.game.meldSwitch(e),this.setupClickers()}clickCalculate(t){t.preventDefault();let e=this.game.checkScore(),i=document.querySelector(".scores");i.innerHTML="",e.forEach((t=>{let e=document.createElement("li");e.innerText=t,e.setAttribute("score_name",t),i.appendChild(e)}))}};const e=i(87),s=i(393),n=[];document.addEventListener("DOMContentLoaded",(()=>{let i=["c","b","d"],l=["east","south","west","north","red","green","white"];for(let t in i)for(let e=1;e<10;e++){let l=new s(i[t],e);n.push(l)}for(let t in l){let e=new s(l[t],0);n.push(e)}new t(new e(n),n)}))}()}();
//# sourceMappingURL=main.js.map